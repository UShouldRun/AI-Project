# create_ds.py Documentation

A utility script that generates a dataset of self-play Connect4 games using the Monte Carlo Tree Search (MCTS) algorithm and saves it to a CSV file.

## Overview

The `create_ds.py` script automates the process of creating a training dataset for Connect4 AI models. It simulates games using the Monte Carlo Tree Search (MCTS) algorithm where an AI plays against itself. The generated dataset consists of board states, actions taken, and implicitly encodes the final game results, all saved in a structured CSV format. This dataset is designed to be used for training machine learning models to play Connect4 strategically.

## Requirements

- Python 3.7+
- Dependencies:
  - `lib.mcts`: Custom MCTS implementation
  - `lib.connect4`: Connect4 game logic
  - NumPy
  - Standard Python libraries (csv, random, asyncio, os, sys)

## Functions

### `progress_print(iteration: int, total_items: int) -> None`

Displays a progress bar in the console during the dataset generation process.

**Parameters:**
- `iteration`: The current iteration number (0-based)
- `total_items`: The total number of items to process

**Example output:**
```
[==========================================] 100% (10/10)
```

### `def generate_ds(s_rollout: int, dt_size: int) -> np.ndarray`

Generates a dataset of self-play Connect4 games using MCTS.

**Parameters:**
- `s_rollout`: The number of MCTS simulations to perform for each move
- `dt_size`: The total number of games to generate

**Returns:**
A NumPy array of length `dt_size`, where each element is a dictionary representing a single game. The dictionary has keys `1` and `2` (for each player), and each value is a NumPy array of `(board, action)` tuples for that player's moves during the game.

**Process:**
1. Initializes an empty game board (6Ã—7 Connect4 grid)
2. Optionally makes 0-8 random initial moves to create diverse starting positions
3. Uses MCTS to play each move until the game concludes
4. Records board state and action pairs for each player
5. Returns the compiled game data

### `create_csv(games: np.ndarray, filename: str) -> None`

Saves the generated game data to a CSV file. Each row in the CSV represents a single move made during a game.

**Parameters:**
- `games`: The NumPy array of game data generated by `generate_ds`
- `filename`: The name of the CSV file to create or append to

**CSV Format:**
The CSV file has the following columns:
- `player`: The player who made the move (1 or 2)
- `board1`: The integer representation of player 1's bitboard
- `board2`: The integer representation of player 2's bitboard
- `action`: The column index where the piece was played (0-6)

### `def main()`

The main function that parses command-line arguments, generates the dataset in batches, and saves it to a CSV file.

**Process:**
1. Parses command-line arguments for filename, simulation count, and dataset size
2. Divides the work into batches of 10 games to manage memory usage
3. Generates each batch and immediately saves it to the CSV file
4. Handles any remaining games as a final batch

## Usage

The script is executed from the command line with three arguments:

```bash
python create_ds.py <filename.csv> <s_rollout> <dt_size>
```

**Arguments:**
- `filename.csv`: Name of the output CSV file
- `s_rollout`: Number of MCTS simulations per move (higher values produce stronger play but take longer)
- `dt_size`: Total number of games to generate

**Example:**
```bash
python create_ds.py connect4_dataset.csv 1000 100
```
This would generate a dataset of 100 games, with MCTS performing 1000 simulations per move, and save the results to `connect4_dataset.csv`.

## Performance Considerations

- The script uses batching to avoid memory issues when generating large datasets
- Progress bars indicate completion status for both batch generation and overall progress
- Larger values for `s_rollout` will result in higher quality games but increase generation time

## Data Usage

The generated dataset is designed for training supervised learning models for Connect4, such as:
- Policy networks that predict optimal moves given a board state
- Value networks that evaluate board positions
- End-to-end learning systems for Connect4 strategy
